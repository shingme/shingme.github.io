---
title: 큐브리드(CUBRID) 브로커(BROKER) 가지는 이유
layout: post
tags:
- CUBRID
- DBMS
- DB서버
- broker
---

큐브리드의 브로커에 대해서 정리하고자 함(다 썻는데 날라가서 다시 쓰는중......ㅠ)

(공부하던 중 naver d2 블로거에 정리된 내용이 있어 이를 참조해 공부하고 정리함. 주소는 하단 참고)

보통 자바 웹 애플리케이션을 개발 시, JDBC드라이버로 DB서버를 연결하는데 연결상태 관리를 아파치의 DBCP를 이용해 Connection Pool를 관리함

큐브리드는 보통, 



1) 드라이버 - 브로커(broker) - DB서버의 3-tier 구조를 가짐

 브로커(broker) : 드라이버 DBMS 서버의 중간 레이어 역할을 수행하는 것 
 
 DBMS : 데이터의 집합체인 데이터베이스, 데이터베이스의 데이터를 조작하는 서버, 서버에 요청을 보내는 클라이언트로 구성됨
 
 DB 서버 : 데이터베이스 관리, 디스크에 저장된 데이터를 메모리 구조체로 변환하고 관리하기 위한 버퍼 관리, 동시성 제어, 장애 복구를 위한 관리 등 수행
 
 
 
 큐브리드DBMS를 일반적인 DBMS와 비교하자면, cub_server와 libcubridcs.so로 구성됨
 
 *  cub_server : DB서버 역할을 수행하는 프로세스
 *  libcubridcs.so : cub_server 프로세스의 요청을 보낼 수 있는 클라이언트 모듈로 C로 작성된 라이브러리로 질의 수행계획 같은 옵티마이저 역할을 수행
 
 
 
 
 
 
2) 브로커(broker)를 가지는 이유

 cub_server와 libcubridcs.so로 구성된 큐브리드를 이용해 자바 애플리케이션을 개발 시, libcubridcs.so의 역할을 애플리케이션 서버에서 호출할 수 있는 형태로 만들어야함. 그렇게 되면 JDBC 드라이버 안에서 질의 수행계획 등의 많은 작업을 해야하기 때문에 애플리케이션 서버의 CPU, 메모리 등의 자원을 소요한다는 점이 발생함
 
 
 그래서 JDBC의 요청을 처리할 수 있는 중간 레이어를 두어서 역할을 위임하도록 했는데, 바로 브로커(broker)이다.
 
 
 
 
 
 
 
 3) 브로커(broker)의 구조
 
 cub_broker와 cub_server 2개의 프로세스로 구성
 * cub_broker : 드라이버가 새로운 연결 요청 시, 어떤 cub_cas를 할당할지 결정하는 역할 수행
 * cub_server : 드라이버의 질의 요청에 대해 실제 질의 수행계획으리 만들고 처리하는 프로세스 (connection pooling)

cubrid_broker.conf 에서 브로커 관련 환경설정 가능


4) 처리과정
*  	(1) 애플리케이션 cub_broker에 연결 요청 
*   (2) cub_broker가 서비스 가능한 cub_cas 선택하고 드라이버와 cub_cas 연결
*  	(3) 연결받은 cub_cas는 드라이버가 요청하는 데이터베이스 서버에 접속하기 위해 cub_master에 연결 요청
*  	(4) cub_master는 cub_cas의 연결을 cub_server에 전달
*  	(5) 연결요청 받은 cub_server는 cub_cas와 연결
*  	       (cub_cas와 cub_server 연결된 이후에 드라이버에서 연결을 끊어도 연결 유지)
				 
				 
5) 정리

  큐브리드는 애플리케이션이 direct로 DB에 접속하게 하지 않고, 브로커(broker)를 지나쳐 DB에 접속하도록함
	아파치의 DBCP의 역할과 비슷하다고 볼 수 있음
	그렇기 때문에, 큐브리드에서는 브로커가 DB와의 연결상태를 계속 관리하기 때문에 DBCP의 연결검증을 별도로 실행하지 않음
	
 보통, 아파치의 DBCP 를 사용하면 여기서 connection pool 갯수 설정 등을 관리하는데
	 
	 
큐브리드는 DB서버와 연결을 맺는 cub_cas를 cubrid_broker.conf 파일에 지정된 갯수만큼 유지하면서 애플리케이션에서 요청할 때마다 cub_cas를 할당해주고 다시 반납하는 구조를 이용함 (자체 연결 풀을 관리!)
				 
	
6) 남기는 말

 여러 종류의 DBMS가 있지만, 각자 가지는 장점과 단점이 있다. 
 보통 오라클 DBMS를 많이 사용해 이에 대한 지식으로 다른 DBMS를 대할 때가 있는거 같다. 그래서 오라클과 비교하고 성능이 떨어진다고 판단을 하는 경우를 봤다. 오라클은 해당 기능을 지원하는데 이 DBMS는 지원도 안한다는 이유로 말이다.. 
 이번 기회에 큐브리드가 가지는 장점을 완벽하게는 아니지만 조금이나마 공부할 기회가 생겨 구조를 공부하게 되었는데 큐브리드만이 가지고 있는 장점이 있는 거 같다. 
 그래서.. 해당 장점을 잘 파악하고 판단의 시선을 가지지 말고 개발 및 유지보수를 한다면 잘 굴러가는 시스템이 되지 않을까...? 
 아직 더 경험이 필요하고 공부도 많이 해야겠지만, 옆에서 판단의 시선으로 시스템을 본다면 그 이유를 명확히 알고 접근할 수 있도록 하는 것이 필요한거 같당 ! 
				 
출처 : https://d2.naver.com/helloworld/1197